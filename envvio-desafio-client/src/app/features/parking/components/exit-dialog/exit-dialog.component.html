<h2 mat-dialog-title>Registrar Saída</h2>

<mat-dialog-content>
  
  <!-- Loading Preview -->
  <div *ngIf="isLoadingPreview" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Calculando valor...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="!isLoadingPreview && errorMessage" class="error-message">
    <mat-icon>error</mat-icon>
    {{ errorMessage }}
  </div>

  <!-- Preview Details -->
  <div *ngIf="!isLoadingPreview && preview && !errorMessage" class="preview-container">
    
    <div class="vehicle-info">
      <h3>Informações do Veículo</h3>
      <div class="info-row">
        <span class="label">Placa:</span>
        <span class="value">{{ preview.vehicle?.plate }}</span>
      </div>
      <div class="info-row">
        <span class="label">Modelo:</span>
        <span class="value">{{ preview.vehicle?.model }}</span>
      </div>
      <div class="info-row">
        <span class="label">Tipo:</span>
        <span class="value">{{ getVehicleTypeDisplay(preview.vehicle?.type) }}</span>
      </div>
    </div>

    <mat-divider></mat-divider>

    <div class="parking-info">
      <h3>Detalhes do Estacionamento</h3>
      <div class="info-row">
        <span class="label">Entrada:</span>
        <span class="value">{{ formatLocalTime(preview.entryTime) }}</span>
      </div>
      <div class="info-row">
        <span class="label">Saída:</span>
        <span class="value">{{ formatLocalTime(preview.exitTime) }}</span>
      </div>
      <div class="info-row">
        <span class="label">Duração:</span>
        <span class="value">{{ formatDuration(preview.duration) }}</span>
      </div>
    </div>

    <mat-divider></mat-divider>

    <div class="total-amount">
      <span class="label">Valor Total:</span>
      <span class="value">{{ formatCurrency(preview.amountCharged) }}</span>
    </div>

  </div>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" [disabled]="isSubmitting">
    Cancelar
  </button>
  <button mat-raised-button color="accent" (click)="onConfirm()" 
          [disabled]="isSubmitting || isLoadingPreview || !!errorMessage">
    <mat-icon *ngIf="isSubmitting">
      <mat-spinner diameter="20"></mat-spinner>
    </mat-icon>
    Confirmar Saída
  </button>
</mat-dialog-actions>
